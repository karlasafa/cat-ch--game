<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cat(ch) Game</title>
  <style>
    body {
      margin: 0;
      background: #fef6e4;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      border-radius: 16px;
    }
  </style>
</head>
<body>

<canvas id="game" width="800" height="600"></canvas>

<script>
/* ================= BASIC ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let gameState = "start"; // start | play | over
let score = 0;
let objects = [];
let soundOn = true;

/* ================= PLAYER ================= */
const cat = {
  x: 350,
  y: 480,
  width: 120,
  height: 120,
  speed: 7
};

/* ================= IMAGES ================= */
const img = {
  cat: new Image(),
  fish: new Image(),
  bomb: new Image(),
  bgStart: new Image(),
  bgPlay: new Image(),
  bgEnd: new Image(),
  title: new Image(),
  btnStart: new Image()
};

img.cat.src = "assets/images/characters/cat.png";
img.fish.src = "assets/images/items/fish.png";
img.bomb.src = "assets/images/items/chocolate.png";
img.bgStart.src = "assets/images/backgrounds/bg_start.png";
img.bgPlay.src = "assets/images/backgrounds/bg_play.png";
img.bgEnd.src = "assets/images/backgrounds/bg_end.png";
img.title.src = "assets/images/ui/title.png";
img.btnStart.src = "assets/images/ui/start.png";

/* ================= SOUNDS ================= */
const clickSound = new Audio("assets/sounds/click.mp3");
const eatSound   = new Audio("assets/sounds/eat.mp3");
const failSound  = new Audio("assets/sounds/fail.mp3");
const bgm        = new Audio("assets/sounds/bg-music.mp3");

bgm.loop = true;
bgm.volume = 0.4;

function playSound(sound) {
  if (soundOn) {
    sound.currentTime = 0;
    sound.play();
  }
}

/* ================= INPUT ================= */
let left = false;
let right = false;

document.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") left = true;
  if (e.key === "ArrowRight") right = true;
});

document.addEventListener("keyup", e => {
  if (e.key === "ArrowLeft") left = false;
  if (e.key === "ArrowRight") right = false;
});

/* ================= OBJECT ================= */
function spawnObject() {
  const isBomb = Math.random() < 0.3;
  objects.push({
    x: Math.random() * 720,
    y: -60,
    size: 60,
    speed: 3 + Math.random() * 2,
    type: isBomb ? "bomb" : "fish"
  });
}

/* ================= COLLISION ================= */
function collide(a, b) {
  return (
    a.x < b.x + b.size &&
    a.x + a.width > b.x &&
    a.y < b.y + b.size &&
    a.y + a.height > b.y
  );
}

/* ================= GAME FLOW ================= */
function startGame() {
  playSound(clickSound);
  score = 0;
  objects = [];
  cat.x = 350;
  gameState = "play";
  if (soundOn) bgm.play();
}

function gameOver() {
  playSound(failSound);
  bgm.pause();
  bgm.currentTime = 0;
  gameState = "over";
}

/* ================= UPDATE ================= */
function update() {
  if (gameState !== "play") return;

  if (left && cat.x > 0) cat.x -= cat.speed;
  if (right && cat.x < 680) cat.x += cat.speed;

  objects.forEach(o => {
    o.y += o.speed;

    if (collide(cat, o)) {
      if (o.type === "fish") {
        score++;
        playSound(eatSound);
      } else {
        gameOver();
      }
      o.y = 700;
    }
  });

  objects = objects.filter(o => o.y < 650);
}

/* ================= DRAW ================= */
function drawStart() {
  ctx.drawImage(img.bgStart, 0, 0, 800, 600);
  ctx.drawImage(img.title, 200, 120, 400, 140);
  ctx.drawImage(img.btnStart, 300, 320, 200, 80);

  ctx.fillStyle = "#fff";
  ctx.font = "20px Arial";
  ctx.fillText("Sound: " + (soundOn ? "ON" : "OFF"), 350, 430);
}

function drawPlay() {
  ctx.drawImage(img.bgPlay, 0, 0, 800, 600);
  ctx.drawImage(img.cat, cat.x, cat.y, cat.width, cat.height);

  objects.forEach(o => {
    const image = o.type === "fish" ? img.fish : img.bomb;
    ctx.drawImage(image, o.x, o.y, o.size, o.size);
  });

  ctx.fillStyle = "#000";
  ctx.font = "24px Arial";
  ctx.fillText("Score: " + score, 20, 40);
}

function drawOver() {
  ctx.drawImage(img.bgEnd, 0, 0, 800, 600);
  ctx.fillStyle = "#fff";
  ctx.font = "40px Arial";
  ctx.fillText("Game Over", 280, 260);
  ctx.font = "24px Arial";
  ctx.fillText("Score: " + score, 360, 310);
  ctx.fillText("Click to restart", 300, 360);
}

function draw() {
  ctx.clearRect(0, 0, 800, 600);
  if (gameState === "start") drawStart();
  if (gameState === "play") drawPlay();
  if (gameState === "over") drawOver();
}

/* ================= CLICK ================= */
canvas.addEventListener("click", e => {
  const x = e.offsetX;
  const y = e.offsetY;

  if (gameState === "start") {
    // Start button
    if (x >= 300 && x <= 500 && y >= 320 && y <= 400) {
      startGame();
    }
    // Sound toggle
    if (x >= 340 && x <= 460 && y >= 410 && y <= 440) {
      soundOn = !soundOn;
      if (!soundOn) {
        bgm.pause();
        bgm.currentTime = 0;
      }
    }
  }

  if (gameState === "over") {
    gameState = "start";
  }
});

/* ================= LOOP ================= */
setInterval(spawnObject, 900);

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
